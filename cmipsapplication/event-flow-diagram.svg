<svg xmlns="http://www.w3.org/2000/svg" width="1600" height="1100" viewBox="0 0 1600 1100">
  <defs>
    <linearGradient id="flowGradient" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#3498db;stop-opacity:1" />
      <stop offset="50%" style="stop-color:#9b59b6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#e67e22;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="blueGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#3498db;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#2980b9;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="orangeGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#f39c12;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#e67e22;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="purpleGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#9b59b6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#8e44ad;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="greenGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#27ae60;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#229954;stop-opacity:1" />
    </linearGradient>
    
    <!-- Arrow markers -->
    <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#e74c3c" />
    </marker>
    <marker id="arrowOrange" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#f39c12" />
    </marker>
    <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#9b59b6" />
    </marker>
    <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#3498db" />
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#27ae60" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="800" y="30" font-size="32" font-weight="bold" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    CMIPS Event Flow &amp; Task Generation (With Kafka)
  </text>
  <text x="800" y="55" font-size="16" text-anchor="middle" fill="#7f8c8d" font-family="Arial, sans-serif">
    Asynchronous Event-Driven Architecture
  </text>
  
  <!-- STEP 1: Event Trigger -->
  <rect x="100" y="100" width="220" height="140" fill="#e74c3c" rx="10" opacity="0.9"/>
  <text x="210" y="130" font-size="18" font-weight="bold" text-anchor="middle" fill="white" font-family="Arial, sans-serif">
    Step 1: Event Trigger
  </text>
  <rect x="120" y="150" width="180" height="25" fill="white" rx="5"/>
  <text x="210" y="167" font-size="13" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    Case Created
  </text>
  <rect x="120" y="185" width="180" height="25" fill="white" rx="5"/>
  <text x="210" y="202" font-size="13" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    Timesheet Exception
  </text>
  <rect x="120" y="220" width="180" height="25" fill="white" rx="5"/>
  <text x="210" y="237" font-size="13" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    Provider Relocated
  </text>
  
  <path d="M 210 240 L 210 300" stroke="#e74c3c" stroke-width="4" fill="none" marker-end="url(#arrowRed)"/>
  
  <!-- STEP 2: Backend Detects & Publishes -->
  <rect x="100" y="320" width="220" height="140" fill="url(#blueGrad)" rx="10" opacity="0.9"/>
  <text x="210" y="350" font-size="18" font-weight="bold" text-anchor="middle" fill="white" font-family="Arial, sans-serif">
    Step 2: Backend Service
  </text>
  <rect x="120" y="370" width="180" height="25" fill="white" rx="5"/>
  <text x="210" y="387" font-size="13" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    Detects Event
  </text>
  <rect x="120" y="405" width="180" height="25" fill="white" rx="5"/>
  <text x="210" y="422" font-size="13" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    Kafka Producer
  </text>
  <rect x="120" y="440" width="180" height="25" fill="#e8f5e9" rx="5"/>
  <text x="210" y="457" font-size="12" text-anchor="middle" fill="#27ae60" font-family="Arial, sans-serif">
    âš¡ Non-Blocking (0.1s)
  </text>
  
  <path d="M 320 390 L 420 390" stroke="#f39c12" stroke-width="5" fill="none" marker-end="url(#arrowOrange)"/>
  <text x="370" y="385" font-size="11" text-anchor="middle" fill="#f39c12" font-family="Arial, sans-serif" font-weight="bold">
    publish event
  </text>
  
  <!-- STEP 3: Kafka Queue -->
  <rect x="420" y="320" width="220" height="140" fill="url(#orangeGrad)" rx="10" opacity="0.9"/>
  <text x="530" y="350" font-size="18" font-weight="bold" text-anchor="middle" fill="white" font-family="Arial, sans-serif">
    Step 3: Kafka Queue
  </text>
  <rect x="440" y="370" width="180" height="25" fill="white" rx="5"/>
  <text x="530" y="387" font-size="13" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    Topic: cmips-case-events
  </text>
  <rect x="440" y="405" width="180" height="25" fill="white" rx="5"/>
  <text x="530" y="422" font-size="13" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    3 Partitions
  </text>
  <rect x="440" y="440" width="180" height="25" fill="#fff3cd" rx="5"/>
  <text x="530" y="457" font-size="12" text-anchor="middle" fill="#856404" font-family="Arial, sans-serif">
    ðŸ’¾ Event Stored &amp; Buffered
  </text>
  
  <path d="M 640 390 L 740 390" stroke="#9b59b6" stroke-width="5" fill="none" marker-end="url(#arrowPurple)"/>
  <text x="690" y="385" font-size="11" text-anchor="middle" fill="#9b59b6" font-family="Arial, sans-serif" font-weight="bold">
    consume event
  </text>
  
  <!-- STEP 4: Consumer Reads -->
  <rect x="740" y="320" width="220" height="140" fill="url(#purpleGrad)" rx="10" opacity="0.9"/>
  <text x="850" y="350" font-size="18" font-weight="bold" text-anchor="middle" fill="white" font-family="Arial, sans-serif">
    Step 4: Consumer Reads
  </text>
  <rect x="760" y="370" width="180" height="25" fill="white" rx="5"/>
  <text x="850" y="387" font-size="13" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    TaskEventConsumer
  </text>
  <rect x="760" y="405" width="180" height="25" fill="white" rx="5"/>
  <text x="850" y="422" font-size="13" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    Group: task-consumer-group
  </text>
  <rect x="760" y="440" width="180" height="25" fill="#fff3cd" rx="5"/>
  <text x="850" y="457" font-size="12" text-anchor="middle" fill="#856404" font-family="Arial, sans-serif">
    ðŸ”„ Processes Event
  </text>
  
  <path d="M 850 460 L 850 520" stroke="#9b59b6" stroke-width="4" fill="none" marker-end="url(#arrowPurple)"/>
  
  <!-- STEP 5: Create Task & Notification -->
  <rect x="740" y="540" width="220" height="140" fill="url(#greenGrad)" rx="10" opacity="0.9"/>
  <text x="850" y="570" font-size="18" font-weight="bold" text-anchor="middle" fill="white" font-family="Arial, sans-serif">
    Step 5: Create Task
  </text>
  <rect x="760" y="590" width="180" height="25" fill="white" rx="5"/>
  <text x="850" y="607" font-size="13" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    TaskService.createTask()
  </text>
  <rect x="760" y="625" width="180" height="25" fill="white" rx="5"/>
  <text x="850" y="642" font-size="13" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    NotificationService.createNotification()
  </text>
  <rect x="760" y="660" width="180" height="25" fill="#fff3cd" rx="5"/>
  <text x="850" y="677" font-size="12" text-anchor="middle" fill="#856404" font-family="Arial, sans-serif">
    Assigned by Role
  </text>
  
  <path d="M 640 605 L 740 605" stroke="#34495e" stroke-width="4" fill="none" marker-end="url(#arrowBlue)"/>
  
  <!-- STEP 6: Database -->
  <rect x="420" y="540" width="220" height="140" fill="#34495e" rx="10" opacity="0.9"/>
  <text x="530" y="570" font-size="18" font-weight="bold" text-anchor="middle" fill="white" font-family="Arial, sans-serif">
    Step 6: Database
  </text>
  <rect x="440" y="590" width="180" height="25" fill="white" rx="5"/>
  <text x="530" y="607" font-size="13" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    PostgreSQL
  </text>
  <rect x="440" y="625" width="180" height="25" fill="white" rx="5"/>
  <text x="530" y="642" font-size="13" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    tasks table
  </text>
  <rect x="440" y="660" width="180" height="25" fill="white" rx="5"/>
  <text x="530" y="677" font-size="13" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    notifications table
  </text>
  
  <path d="M 320 605 L 420 605" stroke="#34495e" stroke-width="4" fill="none" marker-end="url(#arrowBlue)"/>
  
  <!-- STEP 7: Frontend Display -->
  <rect x="100" y="540" width="220" height="140" fill="url(#greenGrad)" rx="10" opacity="0.9"/>
  <text x="210" y="570" font-size="18" font-weight="bold" text-anchor="middle" fill="white" font-family="Arial, sans-serif">
    Step 7: Frontend
  </text>
  <rect x="120" y="590" width="180" height="25" fill="white" rx="5"/>
  <text x="210" y="607" font-size="13" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    WorkView Component
  </text>
  <rect x="120" y="625" width="180" height="25" fill="white" rx="5"/>
  <text x="210" y="642" font-size="13" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    NotificationCenter
  </text>
  <rect x="120" y="660" width="180" height="25" fill="#fff3cd" rx="5"/>
  <text x="210" y="677" font-size="12" text-anchor="middle" fill="#856404" font-family="Arial, sans-serif">
    User Sees Tasks &amp; Alerts
  </text>
  
  <!-- Arrow from database to frontend -->
  <path d="M 210 540 Q 100 500 100 460" stroke="#27ae60" stroke-width="3" fill="none" marker-end="url(#arrowGreen)" stroke-dasharray="5,5"/>
  <text x="130" y="485" font-size="11" text-anchor="middle" fill="#27ae60" font-family="Arial, sans-serif" font-weight="bold">
    API calls
  </text>
  
  <!-- Role-Based Task Assignment Side -->
  <rect x="1050" y="100" width="450" height="580" fill="#ecf0f1" stroke="#95a5a6" stroke-width="2" rx="10"/>
  <text x="1275" y="130" font-size="20" font-weight="bold" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    Role-Based Task Assignment
  </text>
  
  <!-- CASE_WORKER -->
  <rect x="1070" y="160" width="410" height="90" fill="#bdc3c7" rx="5" opacity="0.8"/>
  <text x="1275" y="185" font-size="16" font-weight="bold" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    CASE_WORKER
  </text>
  <text x="1070" y="210" font-size="12" text-anchor="start" fill="#34495e" font-family="Arial, sans-serif">
    â€¢ Case management tasks
  </text>
  <text x="1070" y="230" font-size="12" text-anchor="start" fill="#34495e" font-family="Arial, sans-serif">
    â€¢ Address validation
  </text>
  
  <!-- RECIPIENT -->
  <rect x="1070" y="270" width="410" height="90" fill="#d5dbdb" rx="5" opacity="0.8"/>
  <text x="1275" y="295" font-size="16" font-weight="bold" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    RECIPIENT
  </text>
  <text x="1070" y="320" font-size="12" text-anchor="start" fill="#34495e" font-family="Arial, sans-serif">
    â€¢ Timesheet approval tasks
  </text>
  <text x="1070" y="340" font-size="12" text-anchor="start" fill="#34495e" font-family="Arial, sans-serif">
    â€¢ Provider evaluation
  </text>
  
  <!-- PROVIDER -->
  <rect x="1070" y="380" width="410" height="90" fill="#ebdef0" rx="5" opacity="0.8"/>
  <text x="1275" y="405" font-size="16" font-weight="bold" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    PROVIDER
  </text>
  <text x="1070" y="430" font-size="12" text-anchor="start" fill="#34495e" font-family="Arial, sans-serif">
    â€¢ Self-service tasks
  </text>
  <text x="1070" y="450" font-size="12" text-anchor="start" fill="#34495e" font-family="Arial, sans-serif">
    â€¢ Document submission
  </text>
  
  <!-- SUPERVISOR -->
  <rect x="1070" y="490" width="410" height="90" fill="#fadbd8" rx="5" opacity="0.8"/>
  <text x="1275" y="515" font-size="16" font-weight="bold" text-anchor="middle" fill="#2c3e50" font-family="Arial, sans-serif">
    SUPERVISOR
  </text>
  <text x="1070" y="540" font-size="12" text-anchor="start" fill="#34495e" font-family="Arial, sans-serif">
    â€¢ Escalated tasks
  </text>
  <text x="1070" y="560" font-size="12" text-anchor="start" fill="#34495e" font-family="Arial, sans-serif">
    â€¢ Exception handling
  </text>
  
  <!-- Kafka Benefits Box -->
  <rect x="1070" y="600" width="410" height="60" fill="#d4edda" rx="5" stroke="#28a745" stroke-width="2"/>
  <text x="1275" y="625" font-size="14" font-weight="bold" text-anchor="middle" fill="#155724" font-family="Arial, sans-serif">
    Kafka Benefits:
  </text>
  <text x="1275" y="645" font-size="11" text-anchor="middle" fill="#155724" font-family="Arial, sans-serif">
    âœ… Non-Blocking | âœ… Decoupled | âœ… Scalable | âœ… Fault Tolerant | âœ… Event Replay
  </text>
  
  <!-- Flow Timeline -->
  <rect x="100" y="720" width="1400" height="120" fill="#f8f9fa" rx="5" stroke="#6c757d" stroke-width="2"/>
  <text x="800" y="745" font-size="18" font-weight="bold" text-anchor="middle" fill="#495057" font-family="Arial, sans-serif">
    Event Flow Timeline
  </text>
  
  <!-- Timeline steps -->
  <circle cx="200" cy="800" r="15" fill="#e74c3c"/>
  <text x="200" y="805" font-size="12" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-weight="bold">1</text>
  <text x="200" y="830" font-size="11" text-anchor="middle" fill="#495057" font-family="Arial, sans-serif">Event</text>
  <text x="200" y="845" font-size="10" text-anchor="middle" fill="#6c757d" font-family="Arial, sans-serif">Trigger</text>
  
  <path d="M 215 800 L 385 800" stroke="#3498db" stroke-width="2"/>
  
  <circle cx="400" cy="800" r="15" fill="#3498db"/>
  <text x="400" y="805" font-size="12" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-weight="bold">2</text>
  <text x="400" y="830" font-size="11" text-anchor="middle" fill="#495057" font-family="Arial, sans-serif">Publish</text>
  <text x="400" y="845" font-size="10" text-anchor="middle" fill="#6c757d" font-family="Arial, sans-serif">0.1s</text>
  
  <path d="M 415 800 L 585 800" stroke="#f39c12" stroke-width="2"/>
  
  <circle cx="600" cy="800" r="15" fill="#f39c12"/>
  <text x="600" y="805" font-size="12" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-weight="bold">3</text>
  <text x="600" y="830" font-size="11" text-anchor="middle" fill="#495057" font-family="Arial, sans-serif">Kafka</text>
  <text x="600" y="845" font-size="10" text-anchor="middle" fill="#6c757d" font-family="Arial, sans-serif">Stored</text>
  
  <path d="M 615 800 L 785 800" stroke="#9b59b6" stroke-width="2"/>
  
  <circle cx="800" cy="800" r="15" fill="#9b59b6"/>
  <text x="800" y="805" font-size="12" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-weight="bold">4</text>
  <text x="800" y="830" font-size="11" text-anchor="middle" fill="#495057" font-family="Arial, sans-serif">Consume</text>
  <text x="800" y="845" font-size="10" text-anchor="middle" fill="#6c757d" font-family="Arial, sans-serif">Async</text>
  
  <path d="M 815 800 L 985 800" stroke="#27ae60" stroke-width="2"/>
  
  <circle cx="1000" cy="800" r="15" fill="#27ae60"/>
  <text x="1000" y="805" font-size="12" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-weight="bold">5</text>
  <text x="1000" y="830" font-size="11" text-anchor="middle" fill="#495057" font-family="Arial, sans-serif">Create</text>
  <text x="1000" y="845" font-size="10" text-anchor="middle" fill="#6c757d" font-family="Arial, sans-serif">Task</text>
  
  <path d="M 1015 800 L 1185 800" stroke="#34495e" stroke-width="2"/>
  
  <circle cx="1200" cy="800" r="15" fill="#34495e"/>
  <text x="1200" y="805" font-size="12" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-weight="bold">6</text>
  <text x="1200" y="830" font-size="11" text-anchor="middle" fill="#495057" font-family="Arial, sans-serif">Database</text>
  <text x="1200" y="845" font-size="10" text-anchor="middle" fill="#6c757d" font-family="Arial, sans-serif">Saved</text>
  
  <path d="M 1215 800 L 1385 800" stroke="#27ae60" stroke-width="2"/>
  
  <circle cx="1400" cy="800" r="15" fill="#27ae60"/>
  <text x="1400" y="805" font-size="12" text-anchor="middle" fill="white" font-family="Arial, sans-serif" font-weight="bold">7</text>
  <text x="1400" y="830" font-size="11" text-anchor="middle" fill="#495057" font-family="Arial, sans-serif">Frontend</text>
  <text x="1400" y="845" font-size="10" text-anchor="middle" fill="#6c757d" font-family="Arial, sans-serif">Display</text>
  
  <!-- Footer -->
  <text x="800" y="1050" font-size="14" text-anchor="middle" fill="#7f8c8d" font-family="Arial, sans-serif">
    Event-Driven Task Generation: Kafka enables asynchronous, scalable, and fault-tolerant processing
  </text>
  
</svg>
