<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Timesheet Analytics Dashboard</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        .dashboard {
            max-width: none;
            width: 100%;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin: 20px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: calc(100% - 40px);
            max-width: none;
            box-sizing: border-box;
        }

        .header h1 {
            font-size: 2.8rem;
            background: linear-gradient(45deg, #667eea, #764ba2);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 1.1rem;
        }

        .controls-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin: 20px;
            margin-bottom: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: calc(100% - 40px);
            max-width: none;
            box-sizing: border-box;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            width: 100%;
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        .control-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
            font-size: 0.9rem;
        }

        .control-group input,
        .control-group select {
            padding: 12px 16px;
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .control-group input:focus,
        .control-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #f093fb, #f5576c);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(240, 147, 251, 0.3);
        }

        .btn-success {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(79, 172, 254, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .status {
            padding: 15px 20px;
            border-radius: 12px;
            margin: 20px 0;
            font-weight: 500;
            text-align: center;
        }

        .status-success {
            background: linear-gradient(45deg, #4facfe, #00f2fe);
            color: white;
        }

        .status-error {
            background: linear-gradient(45deg, #f093fb, #f5576c);
            color: white;
        }

        .status-info {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .access-warning {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-top: 10px;
            padding: 12px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            color: #856404;
        }

        .warning-icon {
            font-size: 18px;
            flex-shrink: 0;
        }

        .warning-text {
            flex: 1;
            font-size: 14px;
            line-height: 1.4;
        }

        .warning-text strong {
            color: #b8860b;
        }

        .warning-text small {
            color: #6c757d;
            font-size: 12px;
        }


        .results-panel {
            background: rgba(255, 255, 255, 0.95) !important;
            backdrop-filter: blur(10px) !important;
            border-radius: 20px !important;
            padding: 30px !important;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1) !important;
            width: 100% !important;
            min-height: 100% !important;
            max-width: 100% !important;
            margin: 0 !important;
            box-sizing: border-box !important;
            overflow-y: auto !important;
        }

        .results-panel h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }

        .data-table {
            width: 100% !important;
            max-width: 100% !important;
            border-collapse: collapse !important;
            margin-top: 20px !important;
            min-height: 200px !important;
            table-layout: fixed !important;
            overflow: hidden !important;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e1e5e9;
        }

        .data-table th {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            font-weight: 600;
        }

        .data-table tr:hover {
            background: rgba(102, 126, 234, 0.05);
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .comparison-card {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .comparison-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .comparison-card h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .comparison-card .value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #667eea;
        }

        .role-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .role-group {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            border: 2px solid #e9ecef;
        }

        .role-group h4 {
            margin: 0 0 10px 0;
            color: #495057;
            font-size: 1rem;
            font-weight: 600;
        }

        .role-chip {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
            margin: 5px 0;
            background: white;
        }

        .role-chip.selected {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
            transform: scale(1.02);
        }

        .role-chip:hover {
            border-color: #667eea;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.2);
        }

        .role-chip .role-icon {
            font-size: 1.2rem;
        }

        .comparison-results {
            display: grid !important;
            grid-template-columns: 1fr !important;
            gap: 25px !important;
            margin-top: 20px !important;
            min-height: 300px !important;
            width: 100% !important;
            max-width: 100% !important;
        }

        .comparison-card {
            background: white !important;
            border-radius: 12px !important;
            padding: 25px !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
            border-left: 4px solid #667eea !important;
            min-height: 300px !important;
            width: 100% !important;
            max-width: 100% !important;
            box-sizing: border-box !important;
        }

        .comparison-card h4 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .comparison-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .stat-item .label {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-item .value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9rem;
        }

        .comparison-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .comparison-table tr:hover {
            background: #f8f9fa;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: #667eea;
            font-size: 1.1rem;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #e1e5e9;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .metric-card {
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border-left: 4px solid #667eea;
        }

        .metric-card h4 {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .metric-card .value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #333;
        }

        .tabs {
            display: flex;
            border-bottom: 2px solid #e1e5e9;
            margin-bottom: 20px;
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab.active {
            border-bottom-color: #667eea;
            color: #667eea;
        }

        .tab:hover {
            color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .results-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            width: calc(100% - 40px);
            max-width: none;
            box-sizing: border-box;
        }

        .results-panel {
            width: 100%;
            box-sizing: border-box;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 20px;
            gap: 12px;
            flex-wrap: wrap;
        }

        .pagination-controls button {
            min-width: 140px;
        }

        .pagination-info {
            flex: 1;
            text-align: center;
            color: #555;
            font-size: 0.95rem;
        }


        @media (max-width: 768px) {
            .controls-grid {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        console.log('üöÄ React component starting...');
        
        // Destructure React hooks
        const { useState, useEffect } = React;
        
        const Dashboard = () => {
            const [userRole, setUserRole] = useState('');
            const [startDate, setStartDate] = useState('');
            const [endDate, setEndDate] = useState('');
            const [districtId, setDistrictId] = useState('');
            const [countyId, setCountyId] = useState('');
            const [status, setStatus] = useState({ message: '', type: '' });
            const [loading, setLoading] = useState(false);
            const [reportData, setReportData] = useState(null);
            const [currentPage, setCurrentPage] = useState(0);
            const [pageSize, setPageSize] = useState(50);
            const [hasNextPage, setHasNextPage] = useState(false);
            const [hasPreviousPage, setHasPreviousPage] = useState(false);
            const [totalCount, setTotalCount] = useState(0);
            const [totalPages, setTotalPages] = useState(0);
            const [activeTab, setActiveTab] = useState('report');
            const [refreshKey, setRefreshKey] = useState(0);
            const [forceRender, setForceRender] = useState(0);
            
            // Authentication state
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [accessToken, setAccessToken] = useState(null);
            const [currentUser, setCurrentUser] = useState(null);
            const [loginForm, setLoginForm] = useState({ username: '', password: '' });

            useEffect(() => {
                setStartDate('2025-01-01');
                setEndDate('2025-12-31');
            }, []);

            // Auto-set countyId/districtId based on userRole (only when role changes, not on every render)
            // Note: Backend now provides canonical values (district-north, Alameda, etc.) in login response
            // This is a fallback for when backend values are not available
            const previousUserRole = React.useRef(userRole);
            React.useEffect(() => {
                // Only auto-set if the role actually changed and values are not already set from backend
                if (previousUserRole.current !== userRole) {
                    previousUserRole.current = userRole;
                    
                    // Only set if not already set from backend login response
                    if (!districtId && !countyId) {
                        if (userRole === 'COUNTY_WORKER_NORTH') {
                            setCountyId('Alameda'); // Canonical county for NORTH
                        } else if (userRole === 'COUNTY_WORKER_CENTRAL') {
                            setCountyId('Orange'); // Canonical county for CENTRAL
                        } else if (userRole === 'COUNTY_WORKER_SOUTH') {
                            setCountyId('Riverside'); // Canonical county for SOUTH
                        } else if (userRole === 'DISTRICT_WORKER_NORTH') {
                            setDistrictId('district-north'); // Canonical district ID
                        } else if (userRole === 'DISTRICT_WORKER_CENTRAL') {
                            setDistrictId('district-central'); // Canonical district ID
                        } else if (userRole === 'DISTRICT_WORKER_SOUTH') {
                            setDistrictId('district-south'); // Canonical district ID
                        } else if (userRole === 'PROVIDER' || userRole === 'RECIPIENT') {
                            // Providers/Recipients should get their county from backend
                            // Fallback to a default if not provided
                            if (!countyId) {
                                setCountyId('Alameda');
                            }
                        } else if (userRole === 'CENTRAL_WORKER') {
                            // Central workers can see all data, no filters needed
                            setCountyId('');
                            setDistrictId('');
                        }
                    }
                }
            }, [userRole]);

            const showStatus = (message, type) => {
                setStatus({ message, type });
                setTimeout(() => setStatus({ message: '', type: '' }), 5000);
            };

            // Authentication functions
            const loginUser = async () => {
                if (!loginForm.username || !loginForm.password) {
                    showStatus('Please enter username and password', 'error');
                    return;
                }

                try {
                    const response = await fetch('/api/auth/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            username: loginForm.username,
                            password: loginForm.password
                        })
                    });

                    const data = await response.json();
                    
                    if (response.ok && data.accessToken) {
                        setAccessToken(data.accessToken);
                        setCurrentUser(data.user);
                        setIsLoggedIn(true);
                        showStatus('‚úÖ Login successful!', 'success');
                        
                        // Use the role from backend response (data.user.role)
                        // Backend now returns specific roles like COUNTY_WORKER_NORTH, DISTRICT_WORKER_CENTRAL, etc.
                        let role = data.user?.role || 'CENTRAL_WORKER';
                        
                        console.log('üîç Backend returned user role:', role);
                        console.log('üîç Backend returned districtId:', data.user?.districtId);
                        console.log('üîç Backend returned countyId:', data.user?.countyId);
                        console.log('üîç Setting user role in dashboard:', role);
                        setUserRole(role);
                        
                        // Use districtId and countyId from backend if available (new enhancement)
                        if (data.user?.districtId) {
                            setDistrictId(data.user.districtId);
                            console.log('üîç Set districtId from backend:', data.user.districtId);
                        }
                        if (data.user?.countyId) {
                            setCountyId(data.user.countyId);
                            console.log('üîç Set countyId from backend:', data.user.countyId);
                        }
                        
                        // Fetch field masking rules for the logged-in user
                        setTimeout(() => {
                            fetchFieldMaskingRules();
                        }, 1000);
                    } else {
                        showStatus(`‚ùå Login failed: ${data.message || 'Invalid credentials'}`, 'error');
                    }
                } catch (error) {
                    showStatus(`‚ùå Login error: ${error.message}`, 'error');
                }
            };

            const logoutUser = () => {
                setAccessToken(null);
                setCurrentUser(null);
                setIsLoggedIn(false);
                setLoginForm({ username: '', password: '' });
                setReportData(null);
                showStatus('Logged out successfully', 'info');
            };

            // Field masking integration - fetch user-specific field permissions
            const [fieldMaskingRules, setFieldMaskingRules] = React.useState(null);
            const [permittedFields, setPermittedFields] = React.useState([]);

            // Fetch field masking configuration for current user
            const fetchFieldMaskingRules = async () => {
                if (!isLoggedIn || !userRole) return;

                try {
                    const response = await fetch(`/api/field-masking/interface/${userRole}`, {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`
                        }
                    });

                    if (response.ok) {
                        const data = await response.json();
                        if (data.status === 'SUCCESS') {
                            setFieldMaskingRules(data.interface);
                            
                            // Extract permitted fields based on rules
                            const permitted = data.interface.rules
                                .filter(rule => rule.enabled && rule.accessLevel !== 'HIDDEN_ACCESS')
                                .map(rule => ({
                                    key: rule.fieldName,
                                    label: getFieldDisplayName(rule.fieldName),
                                    maskingType: rule.maskingType,
                                    accessLevel: rule.accessLevel
                                }));
                            
                            setPermittedFields(permitted);
                            console.log('üîí Permitted fields for', userRole, ':', permitted);
                        }
                    }
                } catch (err) {
                    console.error('Failed to fetch field masking rules:', err);
                }
            };

            // Get display name for field
            const getFieldDisplayName = (fieldKey) => {
                const fieldMap = {
                    'timesheetid': 'Timesheet ID',
                    'timesheetId': 'Timesheet ID',
                    'providerid': 'Provider ID',
                    'providerId': 'Provider ID',
                    'providername': 'Provider Name',
                    'providerName': 'Provider Name',
                    'provideremail': 'Provider Email',
                    'providerEmail': 'Provider Email',
                    'providerdepartment': 'Provider Department',
                    'providerDepartment': 'Provider Department',
                    'recipientid': 'Recipient ID',
                    'recipientId': 'Recipient ID',
                    'recipientname': 'Recipient Name',
                    'recipientName': 'Recipient Name',
                    'recipientemail': 'Recipient Email',
                    'recipientEmail': 'Recipient Email',
                    'projectid': 'Project ID',
                    'projectId': 'Project ID',
                    'projectname': 'Project Name',
                    'projectName': 'Project Name',
                    'projectbudget': 'Project Budget',
                    'projectBudget': 'Project Budget',
                    'totalhours': 'Total Hours',
                    'totalHours': 'Total Hours',
                    'hourlyrate': 'Hourly Rate',
                    'hourlyRate': 'Hourly Rate',
                    'totalamount': 'Total Amount',
                    'totalAmount': 'Total Amount',
                    'startdate': 'Start Date',
                    'startDate': 'Start Date',
                    'enddate': 'End Date',
                    'endDate': 'End Date',
                    'status': 'Status',
                    'comments': 'Comments',
                    'approvalstatus': 'Approval Status',
                    'approvalStatus': 'Approval Status',
                    'approvalcomments': 'Approval Comments',
                    'approvalComments': 'Approval Comments',
                    'providercounty': 'Provider County',
                    'providerCounty': 'Provider County',
                    'recipientcounty': 'Recipient County',
                    'recipientCounty': 'Recipient County',
                    'servicelocation': 'Service Location',
                    'serviceLocation': 'Service Location',
                    'servicetype': 'Service Type',
                    'serviceType': 'Service Type',
                    'servicecategory': 'Service Category',
                    'serviceCategory': 'Service Category',
                    'prioritylevel': 'Priority Level',
                    'priorityLevel': 'Priority Level'
                };
                return fieldMap[fieldKey] || fieldKey;
            };

        const formatCellValue = (value, fieldKey) => {
            if (value === null || value === undefined) {
                return 'N/A';
            }

            if (Array.isArray(value)) {
                return value.join('-');
            }

            if (typeof value === 'number') {
                if (fieldKey && fieldKey.toLowerCase().includes('amount')) {
                    return `$${value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
                }
                return value.toLocaleString();
            }

            return value;
        };

            // Apply field masking to data based on user permissions
            const applyFieldMasking = (data) => {
                if (!permittedFields.length) return data;

                return data.map(record => {
                    const maskedRecord = {};
                    
                    permittedFields.forEach(field => {
                        // Try multiple field name variations to handle case differences
                        let value = record[field.key] || 
                                   record[field.key.toLowerCase()] || 
                                   record[field.key.toUpperCase()] ||
                                   record[field.key.replace(/([A-Z])/g, '_$1').toLowerCase()];
                        
                        if (field.accessLevel === 'HIDDEN_ACCESS') {
                            maskedRecord[field.key] = '[HIDDEN]';
                        } else if (field.maskingType === 'HASH_MASK') {
                            maskedRecord[field.key] = value ? `HASH_${value.toString().slice(-4)}` : 'N/A';
                        } else if (field.maskingType === 'ANONYMIZE') {
                            maskedRecord[field.key] = '[ANONYMIZED]';
                        } else if (field.maskingType === 'PARTIAL_MASK' && typeof value === 'string') {
                            if (value.length > 4) {
                                maskedRecord[field.key] = value.slice(0, 2) + '***' + value.slice(-2);
                            } else {
                                maskedRecord[field.key] = '***';
                            }
                        } else if (field.maskingType === 'AGGREGATE') {
                            maskedRecord[field.key] = '[AGGREGATED]';
                        } else {
                            maskedRecord[field.key] = value || 'N/A';
                        }
                    });
                    
                    return maskedRecord;
                });
            };

            const fetchReportPage = async (targetPage = 0, overridePageSize = pageSize, showSuccessToast = true) => {
                if (!isLoggedIn) {
                    showStatus('Please login first to generate reports', 'error');
                    return;
                }

                // Validate dates are set and not empty
                if (!startDate || !endDate || startDate.trim() === '' || endDate.trim() === '') {
                    showStatus('Please select start and end dates', 'error');
                    return;
                }

                setLoading(true);
                try {
                    const requestBody = {
                        districtId: districtId || null,
                        countyId: countyId || null,
                        page: targetPage,
                        pageSize: overridePageSize,
                        startDate: startDate.trim(),
                        endDate: endDate.trim()
                    };
                    
                    console.log('üîç Frontend: Making report request with token:', accessToken ? 'Present' : 'Missing');
                    console.log('üîç Frontend: startDate value:', startDate);
                    console.log('üîç Frontend: endDate value:', endDate);
                    console.log('üîç Frontend: countyId value:', countyId);
                    console.log('üîí Frontend: Effective user role (JWT enforced):', userRole || 'UNKNOWN');
                    console.log('üîç Frontend: Request body:', JSON.stringify(requestBody, null, 2));
                    
                    const response = await fetch('/api/pipeline/generate-report', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${accessToken}`
                        },
                        body: JSON.stringify(requestBody)
                    });

                    const data = await response.json();
                    console.log('üîç Frontend: Response data:', data);
                    console.log('üîç Frontend: Visible fields count:', data.visibleFields ? data.visibleFields.length : 'No visibleFields');
                    
                    if (response.ok) {
                        // Use visibleFields from the report response instead of field masking rules
                        const visibleFields = data.visibleFields || [];
                        const permittedFieldsFromReport = visibleFields.map(fieldName => ({
                            key: fieldName,
                            label: getFieldDisplayName(fieldName),
                            maskingType: 'NONE',
                            accessLevel: 'FULL_ACCESS'
                        }));
                        const pageData = data.data || [];
                        
                        setPermittedFields(permittedFieldsFromReport);
                        setReportData({
                            ...data,
                            data: pageData,
                            page: targetPage,
                            pageSize: overridePageSize
                        });
                        setCurrentPage(targetPage);
                        setHasPreviousPage(targetPage > 0);
                        // Use totalPages from backend if available, otherwise estimate based on pageSize
                        const backendTotalPages = data.totalPages || (data.totalCount ? Math.ceil(data.totalCount / overridePageSize) : 0);
                        const backendTotalCount = data.totalCount || 0;
                        setTotalCount(backendTotalCount);
                        setTotalPages(backendTotalPages);
                        // hasNextPage should be based on totalPages, not just pageData.length
                        setHasNextPage(targetPage + 1 < backendTotalPages);
                        setActiveTab('report');
                        setRefreshKey(prev => prev + 1);
                        setForceRender(prev => prev + 1);
                        
                        if (showSuccessToast) {
                            const recordsMessage = pageData.length === 0
                                ? 'No records found for the selected filters.'
                                : `Showing ${pageData.length} record(s) on page ${targetPage + 1}.`;
                            showStatus(`‚úÖ Report ready! ${recordsMessage}`, 'success');
                        }
                    } else {
                        if (response.status === 403) {
                            showStatus(`üö´ ACCESS DENIED: ${data.message || 'You do not have permission to access this data'}`, 'error');
                        } else if (response.status === 500) {
                            showStatus(`‚ùå Server Error: ${data.message || 'Internal server error occurred'}`, 'error');
                        } else {
                            showStatus(`‚ùå Error: ${data.message || 'Unknown error occurred'}`, 'error');
                        }
                    }
                } catch (error) {
                    showStatus(`‚ùå Network Error: ${error.message}`, 'error');
                } finally {
                    setLoading(false);
                }
            };

            const generateReport = async () => {
                await fetchReportPage(0, pageSize, true);
            };

            const handleNextPage = () => {
                if (hasNextPage && !loading) {
                    fetchReportPage(currentPage + 1, pageSize, false);
                }
            };

            const handlePreviousPage = () => {
                if (currentPage > 0 && !loading) {
                    fetchReportPage(currentPage - 1, pageSize, false);
                }
            };

            const handlePageSizeChange = (value) => {
                const newSize = parseInt(value, 10) || 50;
                setPageSize(newSize);
                setCurrentPage(0);
                
                if (reportData) {
                    fetchReportPage(0, newSize, true);
                }
            };


            const exportData = () => {
                if (!reportData || !reportData.data || reportData.data.length === 0) {
                    showStatus('Please generate a report first', 'error');
                    return;
                }

                // Use the same permittedFields that are used to display the table
                // This ensures the export matches what's shown in the UI
                const fieldsToExport = permittedFields.length > 0 ? permittedFields : getVisibleFieldsForRole(userRole);
                
                const csvContent = generateCSV(reportData.data, fieldsToExport);
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `timesheet-report-${userRole}-${startDate}-${endDate}.csv`;
                a.click();
                window.URL.revokeObjectURL(url);
                showStatus('‚úÖ CSV exported successfully!', 'success');
            };

            const downloadPDF = async () => {
                if (!reportData || !reportData.data || reportData.data.length === 0) {
                    showStatus('Please generate a report first', 'error');
                    return;
                }

                if (!accessToken) {
                    showStatus('Please login first', 'error');
                    return;
                }

                try {
                    showStatus('üìÑ Generating PDF report...', 'info');
                    
                    const response = await fetch('/api/reports/generate-pdf', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${accessToken}`
                        },
                        body: JSON.stringify({
                            userRole: userRole,
                            reportType: 'TIMESHEET_REPORT',
                            startDate: startDate,
                            endDate: endDate,
                            countyId: countyId || null,
                            districtId: districtId || null
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({ message: 'Failed to generate PDF' }));
                        showStatus(`‚ùå PDF generation failed: ${errorData.message || response.statusText}`, 'error');
                        return;
                    }

                    // Get PDF blob from response
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    
                    // Extract filename from Content-Disposition header or use default
                    const contentDisposition = response.headers.get('Content-Disposition');
                    let filename = `timesheet-report-${userRole}-${startDate}-${endDate}.pdf`;
                    if (contentDisposition) {
                        const filenameMatch = contentDisposition.match(/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/);
                        if (filenameMatch && filenameMatch[1]) {
                            filename = filenameMatch[1].replace(/['"]/g, '');
                        }
                    }
                    
                    a.download = filename;
                    a.click();
                    window.URL.revokeObjectURL(url);
                    showStatus('‚úÖ PDF downloaded successfully!', 'success');
                } catch (error) {
                    console.error('‚ùå PDF download error:', error);
                    showStatus(`‚ùå PDF download failed: ${error.message}`, 'error');
                }
            };

            const generateCSV = (data, fields) => {
                if (!data || data.length === 0) {
                    console.error('‚ùå Export: No data to export');
                    return '';
                }
                if (!fields || fields.length === 0) {
                    console.error('‚ùå Export: No fields to export');
                    return '';
                }
                
                console.log('üîç Export: Fields count:', fields.length);
                console.log('üîç Export: Data records count:', data.length);
                console.log('üîç Export: Sample record keys:', Object.keys(data[0] || {}));
                
                const headers = fields.map(field => field.label || field.key);
                
                const rows = data.map((record, recordIndex) => {
                    return fields.map((field, fieldIndex) => {
                        // Try multiple field name variations to match the actual data structure
                        // This matches the same logic used in the table display
                        let value = record[field.key] || 
                                   record[field.key.toLowerCase()] || 
                                   record[field.key.toUpperCase()] ||
                                   record[field.key.replace(/([A-Z])/g, '_$1').toLowerCase()] ||
                                   record[field.key.replace(/([A-Z])/g, '_$1').toUpperCase()] ||
                                   '';
                        
                        // If still no value, try to find it by case-insensitive match
                        if (!value && record) {
                            const recordKeys = Object.keys(record);
                            const matchingKey = recordKeys.find(key => 
                                key.toLowerCase() === field.key.toLowerCase() ||
                                key.toLowerCase() === field.key.replace(/([A-Z])/g, '_$1').toLowerCase()
                            );
                            if (matchingKey) {
                                value = record[matchingKey];
                            }
                        }
                        
                        // Handle null/undefined values
                        if (value === null || value === undefined) {
                            value = '';
                        }
                        
                        // Format the value similar to formatCellValue
                        let formattedValue = value;
                        if (Array.isArray(value)) {
                            formattedValue = value.join(', ');
                        } else if (typeof value === 'number') {
                            if (field.key && field.key.toLowerCase().includes('amount')) {
                                formattedValue = value.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                            } else {
                                formattedValue = value.toLocaleString();
                            }
                        } else if (typeof value === 'object' && value !== null) {
                            formattedValue = JSON.stringify(value);
                        }
                        
                        // Convert to string and handle CSV special characters
                        const stringValue = String(formattedValue);
                        // Escape quotes and wrap in quotes if contains comma, quote, or newline
                        if (stringValue.includes(',') || stringValue.includes('"') || stringValue.includes('\n') || stringValue.includes('\r')) {
                            return `"${stringValue.replace(/"/g, '""')}"`;
                        }
                        return stringValue;
                    });
                });
                
                const csvContent = [headers.join(','), ...rows.map(row => row.join(','))].join('\n');
                console.log('‚úÖ Export: CSV generated, length:', csvContent.length);
                return csvContent;
            };

            const getRoleDisplayName = (role) => {
                const roleNames = {
                    'CENTRAL_WORKER': 'üè¢ Central Worker',
                    'DISTRICT_WORKER_NORTH': 'üèõÔ∏è District Worker - North',
                    'DISTRICT_WORKER_CENTRAL': 'üèõÔ∏è District Worker - Central',
                    'DISTRICT_WORKER_SOUTH': 'üèõÔ∏è District Worker - South',
                    'COUNTY_WORKER_NORTH': 'üèòÔ∏è County Worker - North',
                    'COUNTY_WORKER_CENTRAL': 'üèòÔ∏è County Worker - Central',
                    'COUNTY_WORKER_SOUTH': 'üèòÔ∏è County Worker - South',
                    'PROVIDER': 'üë®‚Äç‚öïÔ∏è Provider',
                    'RECIPIENT': 'üë• Recipient'
                };
                return roleNames[role] || role;
            };

            const getVisibleFieldsForRole = (role) => {
                const allFields = [
                    { key: 'timesheetId', label: 'Timesheet ID' },
                    { key: 'providerId', label: 'Provider ID' },
                    { key: 'providerName', label: 'Provider Name' },
                    { key: 'providerEmail', label: 'Provider Email' },
                    { key: 'providerDepartment', label: 'Provider Department' },
                    { key: 'recipientId', label: 'Recipient ID' },
                    { key: 'recipientName', label: 'Recipient Name' },
                    { key: 'serviceType', label: 'Service Type' },
                    { key: 'description', label: 'Description' },
                    { key: 'totalHours', label: 'Total Hours' },
                    { key: 'totalAmount', label: 'Total Amount' },
                    { key: 'status', label: 'Status' },
                    { key: 'comments', label: 'Comments' },
                    { key: 'providerCounty', label: 'Provider County' },
                    { key: 'recipientCounty', label: 'Recipient County' }
                ];

                switch (role) {
                    case 'CENTRAL_WORKER':
                        return allFields;
                    case 'DISTRICT_WORKER_NORTH':
                    case 'DISTRICT_WORKER_CENTRAL':
                    case 'DISTRICT_WORKER_SOUTH':
                        return allFields.filter(field => 
                            !['provideremail', 'providerid', 'recipientid'].includes(field.key)
                        );
                    case 'COUNTY_WORKER_NORTH':
                    case 'COUNTY_WORKER_CENTRAL':
                    case 'COUNTY_WORKER_SOUTH':
                    case 'COUNTY_WORKER':  // Add support for generic COUNTY_WORKER role
                        return allFields.filter(field => 
                            ['timesheetId', 'providerName', 'recipientId', 'recipientName', 'serviceType', 
                             'description', 'totalHours', 'totalAmount', 'status', 'comments', 
                             'providerCounty', 'recipientCounty'].includes(field.key)
                        );
                    case 'PROVIDER':
                        return allFields.filter(field => 
                            ['timesheetid', 'recipientname', 'service_type', 'description', 
                             'totalhours', 'status', 'comments'].includes(field.key)
                        );
                    case 'RECIPIENT':
                        return allFields.filter(field => 
                            ['timesheetid', 'providername', 'service_type', 'description', 
                             'totalhours', 'status'].includes(field.key)
                        );
                    default:
                        return allFields.filter(field => 
                            ['timesheetid', 'status', 'comments'].includes(field.key)
                        );
                }
            };

            const getStatusColor = (status) => {
                const colors = {
                    'APPROVED': '#28a745',
                    'PENDING': '#ffc107',
                    'REJECTED': '#dc3545',
                    'DRAFT': '#6c757d'
                };
                return colors[status] || '#6c757d';
            };

            // Show login form if not logged in
            if (!isLoggedIn) {
                return (
                    <div className="dashboard">
                        <div className="header">
                            <h1>üìä Advanced Timesheet Analytics</h1>
                            <p>Please login to access the dashboard</p>
                        </div>

                        <div className="controls-panel">
                            <h3>üîê Login Required</h3>
                            <div className="controls-grid">
                                <div className="control-group">
                                    <label>üë§ Username</label>
                                    <input
                                        type="text"
                                        value={loginForm.username}
                                        onChange={(e) => setLoginForm({...loginForm, username: e.target.value})}
                                        placeholder="e.g., central_worker, county_worker"
                                    />
                                </div>
                                <div className="control-group">
                                    <label>üîë Password</label>
                                    <input
                                        type="password"
                                        value={loginForm.password}
                                        onChange={(e) => setLoginForm({...loginForm, password: e.target.value})}
                                        placeholder="Enter your password"
                                    />
                                </div>
                            </div>
                            
                            <div className="button-group">
                                <button className="btn btn-primary" onClick={loginUser}>
                                    üîê Login
                                </button>
                            </div>

                            <div style={{marginTop: '20px', padding: '15px', background: '#f8f9fa', borderRadius: '8px'}}>
                                <h4>Available Test Accounts:</h4>
                                <ul style={{textAlign: 'left', margin: '10px 0'}}>
                                    <li><strong>central_worker</strong> / password123</li>
                                    <li><strong>county_worker</strong> / password123</li>
                                    <li><strong>district_worker</strong> / password123</li>
                                    <li><strong>provider</strong> / password123</li>
                                    <li><strong>recipient</strong> / password123</li>
                                </ul>
                            </div>

                            {status.message && (
                                <div className={`status status-${status.type}`}>
                                    {status.message}
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            return (
                <div className="dashboard">
                    <div className="header">
                        <h1>üìä Advanced Timesheet Analytics</h1>
                        <p>Welcome, {currentUser?.name || 'User'}! Comprehensive reporting and role-based data analysis</p>
                        <button 
                            className="btn btn-secondary" 
                            onClick={logoutUser}
                            style={{marginTop: '10px'}}
                        >
                            üö™ Logout
                        </button>
                    </div>

                    <div className="controls-panel">
                        <div className="controls-grid">
                            <div className="control-group">
                                <label>üë§ Logged In As</label>
                                <input
                                    type="text"
                                    value={userRole ? userRole.replace(/_/g, ' ') : 'Login to load role'}
                                    readOnly
                                    style={{
                                        backgroundColor: '#f0f0f0',
                                        cursor: 'not-allowed',
                                        fontWeight: 600,
                                        textTransform: 'uppercase'
                                    }}
                                />
                                <small style={{color: '#667eea', fontStyle: 'italic', display: 'block', marginTop: '8px', fontWeight: 600}}>
                                    üîí Role is enforced from your Keycloak token. UI overrides are disabled.
                                </small>
                                
                                {userRole && userRole !== 'CENTRAL_WORKER' && isLoggedIn && (
                                    <div className="access-warning">
                                        <div className="warning-icon">‚ö†Ô∏è</div>
                                        <div className="warning-text">
                                            <strong>Access Restriction:</strong> This role can only access data from their assigned county/district.
                                            <br />
                                            <small>You will see only the fields permitted for your role based on Keycloak configuration.</small>
                                        </div>
                                    </div>
                                )}
                            </div>
                            
                            <div className="control-group">
                                <label>üìÖ Start Date</label>
                                <input
                                    type="date"
                                    value={startDate}
                                    onChange={(e) => setStartDate(e.target.value)}
                                />
                            </div>
                            
                            <div className="control-group">
                                <label>üìÖ End Date</label>
                                <input
                                    type="date"
                                    value={endDate}
                                    onChange={(e) => setEndDate(e.target.value)}
                                />
                            </div>

                            <div className="control-group">
                                <label>üèõÔ∏è District ID (Optional)</label>
                                <input 
                                    type="text" 
                                    value={districtId}
                                    onChange={(e) => setDistrictId(e.target.value)}
                                    placeholder="e.g., DISTRICT_A"
                                    readOnly={userRole && userRole.startsWith('DISTRICT_WORKER_')}
                                    style={{backgroundColor: userRole && userRole.startsWith('DISTRICT_WORKER_') ? '#f0f0f0' : 'white'}}
                                />
                                {userRole && userRole.startsWith('DISTRICT_WORKER_') && (
                                    <small style={{color: '#666', fontStyle: 'italic', display: 'block', marginTop: '4px'}}>Auto-set based on selected role</small>
                                )}
                            </div>

                            <div className="control-group">
                                <label>üèòÔ∏è County Selection</label>
                                {userRole === 'CENTRAL_WORKER' ? (
                                    <select 
                                        value={countyId || ''} 
                                        onChange={(e) => {
                                            const newValue = e.target.value;
                                            console.log('üîç County dropdown changed:', newValue);
                                            setCountyId(newValue);
                                        }}
                                        style={{width: '100%', padding: '8px', fontSize: '14px'}}
                                    >
                                        <option value="">All Counties</option>
                                        <option value="Alameda">Alameda</option>
                                        <option value="Los Angeles">Los Angeles</option>
                                        <option value="Orange">Orange</option>
                                        <option value="Riverside">Riverside</option>
                                        <option value="San Diego">San Diego</option>
                                        <option value="San Francisco">San Francisco</option>
                                        <option value="Santa Clara">Santa Clara</option>
                                    </select>
                                ) : userRole && userRole.startsWith('DISTRICT_WORKER_') ? (
                                    <select 
                                        value={countyId || ''} 
                                        onChange={(e) => {
                                            const newValue = e.target.value;
                                            console.log('üîç County dropdown changed:', newValue);
                                            setCountyId(newValue);
                                        }}
                                        style={{width: '100%', padding: '8px', fontSize: '14px'}}
                                    >
                                        <option value="">All Counties in District</option>
                                        {userRole === 'DISTRICT_WORKER_NORTH' && (
                                            <>
                                                <option value="Alameda">Alameda</option>
                                                <option value="San Francisco">San Francisco</option>
                                                <option value="Santa Clara">Santa Clara</option>
                                            </>
                                        )}
                                        {userRole === 'DISTRICT_WORKER_CENTRAL' && (
                                            <>
                                                <option value="Orange">Orange</option>
                                                <option value="Los Angeles">Los Angeles</option>
                                            </>
                                        )}
                                        {userRole === 'DISTRICT_WORKER_SOUTH' && (
                                            <>
                                                <option value="Riverside">Riverside</option>
                                                <option value="San Diego">San Diego</option>
                                            </>
                                        )}
                                    </select>
                                ) : (
                                    <input
                                        type="text"
                                        value={countyId}
                                        onChange={(e) => setCountyId(e.target.value)}
                                        placeholder="e.g., Alameda, San Diego, etc."
                                        readOnly={userRole && (userRole.startsWith('COUNTY_WORKER_') || userRole === 'PROVIDER' || userRole === 'RECIPIENT')}
                                        style={{backgroundColor: userRole && (userRole.startsWith('COUNTY_WORKER_') || userRole === 'PROVIDER' || userRole === 'RECIPIENT') ? '#f0f0f0' : 'white'}}
                                    />
                                )}
                                {userRole && (userRole.startsWith('COUNTY_WORKER_') || userRole === 'PROVIDER' || userRole === 'RECIPIENT') && (
                                    <small style={{color: '#666', fontStyle: 'italic', display: 'block', marginTop: '4px'}}>Auto-set based on selected role</small>
                                )}
                                {userRole === 'CENTRAL_WORKER' && (
                                    <small style={{color: '#666', fontStyle: 'italic', display: 'block', marginTop: '4px'}}>Select specific county or leave empty for all counties</small>
                                )}
                                {userRole && userRole.startsWith('DISTRICT_WORKER_') && (
                                    <small style={{color: '#666', fontStyle: 'italic', display: 'block', marginTop: '4px'}}>Select specific county in your district or leave empty for all counties in district</small>
                                )}
                            </div>

                            <div className="control-group">
                                <label>üìÑ Records Per Page</label>
                                <select value={pageSize} onChange={(e) => handlePageSizeChange(e.target.value)}>
                                    <option value="25">25 records</option>
                                    <option value="50">50 records</option>
                                    <option value="100">100 records</option>
                                    <option value="250">250 records</option>
                                </select>
                                <small style={{color: '#666', display: 'block', marginTop: '6px'}}>
                                    Adjust how many records are returned per page. Use the pagination controls below the table to move between pages.
                                </small>
                            </div>
                        </div>
                        
                        <div className="button-group">
                            <button 
                                className="btn btn-primary" 
                                onClick={generateReport}
                                disabled={loading}
                            >
                                {loading ? <div className="spinner"></div> : 'üìä'} Generate Report
                            </button>
                            
                            <div style={{ display: 'flex', gap: '10px', flexWrap: 'wrap' }}>
                                <button 
                                    className="btn btn-success" 
                                    onClick={exportData}
                                    disabled={!reportData}
                                    title="Export data as CSV"
                                >
                                    üì• Export CSV
                                </button>
                                <button 
                                    className="btn btn-success" 
                                    onClick={downloadPDF}
                                    disabled={!reportData || !isLoggedIn}
                                    title="Download report as PDF"
                                >
                                    üìÑ Download PDF
                                </button>
                            </div>
                        </div>

                        {status.message && (
                            <div className={`status status-${status.type}`}>
                                {status.message}
                            </div>
                        )}
                    </div>

                    <div className="results-container">
                        <div className="results-panel">
                            <h3>üìä Report Results</h3>
                            
                            {loading && (
                                <div className="loading">
                                    <div className="spinner"></div>
                                    Generating report...
                                </div>
                            )}
                            
                            {!loading && reportData && reportData.data && reportData.data.length > 0 && (
                                <div>
                                    <p><strong>‚úÖ Showing {reportData.data.length} record(s) of {totalCount.toLocaleString()} total</strong> (Page {currentPage + 1} of {totalPages || '?'})</p>
                                    <table className="data-table">
                                        <thead>
                                            <tr>
                                                {permittedFields.length > 0 ? permittedFields.map((field, index) => (
                                                    <th key={index}>{field.label}</th>
                                                )) : (
                                                    <th>No fields available</th>
                                                )}
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {reportData.data.map((record, index) => (
                                                <tr key={index}>
                                                    {permittedFields.length > 0 ? permittedFields.map((field, fieldIndex) => (
                                                        <td key={fieldIndex}>
                                                            {formatCellValue(record[field.key], field.key)}
                                                        </td>
                                                    )) : (
                                                        <td>No data available</td>
                                                    )}
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>

                                    {(hasPreviousPage || hasNextPage) && (
                                        <div className="pagination-controls">
                                            <button 
                                                className="btn btn-secondary" 
                                                onClick={handlePreviousPage}
                                                disabled={!hasPreviousPage || loading}
                                            >
                                                ‚Üê Previous Page
                                            </button>
                                            <div className="pagination-info">
                                                <strong>Page {currentPage + 1} of {totalPages || '?'}</strong>
                                                <br />
                                                Showing {reportData.data.length} of {totalCount.toLocaleString()} total record(s)
                                                <br />
                                                <span style={{fontSize: '0.9em', color: '#666'}}>Page size: {pageSize}</span>
                                            </div>
                                            <button 
                                                className="btn btn-secondary" 
                                                onClick={handleNextPage}
                                                disabled={!hasNextPage || loading}
                                            >
                                                Next Page ‚Üí
                                            </button>
                                        </div>
                                    )}
                                </div>
                            )}
                            
                            {!loading && (!reportData || !reportData.data || reportData.data.length === 0) && (
                                <div style={{textAlign: 'center', padding: '40px', color: '#666'}}>
                                    <p>No data available. Click "Generate Report" to fetch data.</p>
                                </div>
                            )}
                        </div>

                    </div>
                </div>
            );
        };

        console.log('üöÄ React component starting...');
        console.log('üîç Root element exists:', document.getElementById('root'));
        console.log('üîç React available:', typeof React);
        console.log('üîç ReactDOM available:', typeof ReactDOM);
        
        // Use React 18 createRoot API
        const { createRoot } = ReactDOM;
        const root = createRoot(document.getElementById('root'));
        
        // Simple test component first
        const TestComponent = () => {
            return React.createElement('div', { style: { padding: '20px', background: 'white', color: 'black' } }, 
                React.createElement('h1', null, 'TESTING - Dashboard Loading'),
                React.createElement('p', null, 'If you see this, React is working!')
            );
        };
        
        try {
            console.log('üîß Testing simple component first...');
            root.render(React.createElement(TestComponent));
            console.log('‚úÖ Test component rendered successfully');
            
            // Now try the full Dashboard
            setTimeout(() => {
                try {
                    console.log('üîß Now rendering full Dashboard...');
                    root.render(React.createElement(Dashboard));
                    console.log('‚úÖ Dashboard rendered successfully');
                } catch (error) {
                    console.error('‚ùå Dashboard failed:', error);
                    console.error('‚ùå Error details:', error.message);
                    console.error('‚ùå Stack trace:', error.stack);
                }
            }, 1000);
        } catch (error) {
            console.error('‚ùå Test component failed:', error);
            console.error('‚ùå Error details:', error.message);
            console.error('‚ùå Stack trace:', error.stack);
        }
    </script>
</body>
</html>